# **Session/Cookie**

## HTTP 특징

- Stateless 상태를 기억하지 않음
- 단순성 : 각 요청이 독립적으로 처리 되기 때문에 이전 요청과 연결할 필요가 없고, 서버의 구성이 단순해여 속도가 빠름
- 확장성 : 여러 서버 간 공유해야 할 상태가 없기 때문에 여러 서버에서 요청을 분산시킬 수 있어 부하 분산 및 시스템 확장에 용이
- 신뢰성 : 요청들이 독립적이기 때문에 한 요청의 실패가 다른 요청에 영향을 미치지 않음으로 시스템 신뢰도 향상
- 자원절약 : 서버에서 상태를 저장하지 않기 때문에 그만큼 서버의 메모리, 저장 공간 절약
- **상태를 기억하지 않는다는 단점(로그인 관리 불가)를 Cookie, Session으로 보완**

![image.png](attachment:592971aa-879f-4806-84e8-2732873a8cc3:image.png)

## Cookie의 주요 property

- **브라우저에 데이터 저장**
- name을 제외한 property는 setter/getter로 접근 가능
- **name** :  쿠키를 만들 때 전달하는 쿠키의 이름으로 유일한 값
    - 동일한 이름의 쿠키는 기존 쿠키를 덮어씀
    - 알파벳, 숫자, 하이픈, 언더스코어, 틸트, 점으로 구성되며 **공백 등 나머지는 URLEncoder를 통해 인코딩 필요**
- **value** : 쿠키의 값으로 쿠키  생성시 전달하거나 setValue()메서드를 통해 설정 가능

```sql
Cookie cookie=new Cookie("username", URLEncoder.encode("status 경로에 저장된 쿠키","UTF-8));
```

- **path** : 쿠키가 유효한 경로
    - path가 설정된 하위 경로에서만 쿠키 전송
    - 경로 미 설정시 : context root로 설정
    - / 로 설정시 container root로 지정되여 동일한 도메인의 다른 애플리케이션까지 접근
- **maxAge** : 쿠키의 유효 기간
    - 양수 : 초 단위로 해당 시간까지 쿠키 존재, 시간이 지나면 자동 폐기
    - 음수 또는 미 지정 시 : 세션 쿠키로 브라우저 종료 등으로 세션 종료 시 폐기
    - 0 : 브라우저에 도착하는 즉시 폐기
- **secure** : HTTPS 에서만 전송 허용
- **httpOnly** : JavaScript에서 접근 불가 설정
- 개발자 도구에서 쿠키 확인 : Application > Cookies
- 쿠키는 “클라이언트에게 전달되어야 확인 가능”

## Session

- **서버에 클라이언트의 상태 값을 저장**
- 하나의 브라우저 당 하나의 세션 성립
- 쿠키는 브라우저를 닫아도 유지될 수 있으나 세션은 브라우저를 닫으면 종료
- 세션이 동작하기 위해서는 JSESSIONID라는 이름의 쿠키 필요
    - JSESSIONID는  서버의 세션 공간에 들어가기 위한 키

![image.png](attachment:82c09a01-2f08-431a-829e-2a32985ee8c1:image.png)

### HttpSession의 유효시간 설정

- WAS의 web.xml에 container 차원의 session-timeout 설정
    - 설정 시간은 분 단위
- 어플리케이션 별 web.xml에서 context단위 재정의 기능

## 강사님

### 쿠키 지우기

- maxAge(0)
- remove()
- invalidate

웹 애플리케이션에서 **세션(Session)**을 유지하기 위해 **JSESSIONID**라는 고유한 식별자가 사용됩니다. `request.getSession()`을 호출하면, 서버는 클라이언트와 연결된 세션을 확인하고, 없으면 새로운 세션을 생성합니다. 이때 **JSESSIONID**가 세션을 식별하는 역할

## **쿠키를 차단하면 발생하는 문제**

- `JSESSIONID`는 기본적으로 **쿠키를 통해 전송**되므로, 쿠키를 차단하면 **서버가 클라이언트를 식별할 수 없게 됨**
- 즉, **클라이언트가 새 요청을 보낼 때마다 새로운 세션이 생성**됨 (로그인 유지 불가능, 장바구니 초기화 등 문제 발생)
